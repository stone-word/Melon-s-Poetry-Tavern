# 调酒师行为系统需求文档

## 简介

本文档定义了酒馆游戏中调酒师的智能行为系统。该系统将实现多个调酒师的协作工作流程，包括订单处理、状态管理和可视化反馈，以创造更真实的酒馆经营体验。

## 术语表

- **调酒师 (Bartender)**: 在吧台工作的NPC，负责制作饮品
- **订单队列 (Order Queue)**: 按时间顺序排列的待处理订单列表
- **备餐时间 (Preparation Time)**: 调酒师制作一份饮品所需的时间
- **准备队列 (Ready Queue)**: 已完成制作、等待服务员取走的饮品队列
- **吧台位置 (Bar Position)**: 吧台区域内的特定工作位置
- **吧台工作区域 (Bar Work Area)**: 吧台内部的5个格子位置，调酒师必须在此区域内制作饮品
- **状态指示器 (Status Indicator)**: 显示调酒师当前工作状态的视觉元素

## 需求

### 需求 1

**用户故事:** 作为玩家，我希望看到调酒师在没有订单时有自然的闲置行为，这样酒馆环境更加生动真实。

#### 验收标准

1. WHEN 调酒师没有待处理订单 THEN 调酒师 SHALL 进入闲置状态并在吧台区域内小范围随机移动
2. WHILE 调酒师处于闲置状态 THEN 调酒师 SHALL 每隔3-8秒随机选择吧台附近的位置移动
3. WHEN 调酒师在闲置状态下移动 THEN 调酒师 SHALL 保持在吧台工作区域内不超出边界
4. WHEN 有新订单到达 THEN 闲置状态的调酒师 SHALL 立即转换为工作状态
5. WHEN 调酒师闲置移动时遇到障碍物 THEN 调酒师 SHALL 重新选择可达的目标位置

### 需求 2

**用户故事:** 作为玩家，我希望调酒师能够按照订单的时间顺序高效处理饮品制作，确保服务的公平性。

#### 验收标准

1. WHEN 吧台收到新订单 THEN 系统 SHALL 将订单添加到按创建时间排序的队列中
2. WHEN 调酒师开始处理订单 THEN 调酒师 SHALL 选择队列中最早的未被处理订单
3. WHILE 调酒师制作饮品 THEN 制作时间 SHALL 在10-30秒之间随机确定
4. WHEN 调酒师完成饮品制作 THEN 系统 SHALL 将完成的订单移动到准备队列中
5. WHEN 饮品制作完成 THEN 调酒师 SHALL 立即检查是否有下一个待处理订单

### 需求 3

**用户故事:** 作为玩家，我希望多个调酒师能够协作工作而不会重复处理同一个订单，提高工作效率。

#### 验收标准

1. WHEN 多个调酒师同时工作 THEN 每个订单 SHALL 只能被一个调酒师处理
2. WHEN 调酒师选择订单处理 THEN 系统 SHALL 立即标记该订单为"处理中"状态
3. WHEN 调酒师开始处理订单 THEN 其他调酒师 SHALL 无法选择相同的订单
4. WHEN 调酒师完成或放弃订单 THEN 系统 SHALL 更新订单状态允许其他调酒师处理
5. WHEN 调酒师因故无法完成订单 THEN 订单 SHALL 重新回到待处理队列供其他调酒师处理

### 需求 4

**用户故事:** 作为玩家，我希望能够清楚地看到每个调酒师的工作状态，了解酒馆的运营情况。

#### 验收标准

1. WHEN 调酒师处于闲置状态 THEN 状态指示器 SHALL 显示灰色表示空闲
2. WHEN 调酒师正在制作饮品 THEN 状态指示器 SHALL 显示蓝色表示忙碌
3. WHEN 调酒师在吧台区域移动 THEN 状态指示器 SHALL 显示灰色表示移动中
4. WHEN 调酒师状态发生变化 THEN 状态指示器 SHALL 立即更新颜色反映新状态
5. WHEN 玩家观察调酒师 THEN 状态指示器 SHALL 在调酒师头部上方清晰可见

### 需求 5

**用户故事:** 作为玩家，我希望调酒师在制作饮品时必须在吧台内的指定工作位置进行，确保工作流程的真实性和合理性。

#### 验收标准

1. WHEN 调酒师开始制作饮品 THEN 调酒师 SHALL 移动到吧台内部的工作区域（5个格子位置）
2. WHILE 调酒师制作饮品 THEN 调酒师 SHALL 保持在吧台内部工作区域内不离开
3. WHEN 调酒师不在吧台工作区域内 THEN 调酒师 SHALL 无法开始制作饮品
4. WHEN 调酒师需要移动到工作位置 THEN 调酒师 SHALL 寻找最近的可用吧台工作位置
5. WHEN 调酒师完成饮品制作 THEN 调酒师 SHALL 可以离开工作位置进行闲置移动

### 需求 6

**用户故事:** 作为玩家，我希望调酒师的工作流程与服务员系统无缝集成，确保整个服务流程的连贯性。

#### 验收标准

1. WHEN 服务员将订单提交到吧台 THEN 订单 SHALL 立即进入调酒师的处理队列
2. WHEN 调酒师完成饮品制作 THEN 服务员 SHALL 能够从准备队列中取走对应订单
3. WHEN 服务员取走饮品 THEN 订单 SHALL 从准备队列中移除并标记为已取走
4. WHEN 订单在准备队列中等待 THEN 订单 SHALL 保持与原始顾客和服务员的关联信息
5. WHEN 系统处理订单流转 THEN 所有相关NPC SHALL 能够正确识别和处理订单状态变化